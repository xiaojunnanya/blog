---
id: cli
slug: /other/cli
title: ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶
date: 2002-09-26
authors: é²¸è½
tags: [tool, cli]
keywords: [tool, cli]
---

## è„šæ‰‹æ¶çš„ç®€å•é›å½¢

### åœ¨å‘½ä»¤è¡Œå¯åŠ¨cli

1. æ–°å»ºé¡¹ç›®ç›®å½• my-node-cli

```js
mkdir my-node-cli 
cd my-node-cli 
npm init # ç”Ÿæˆ package.json æ–‡ä»¶
```

2. æ–°å»ºç¨‹åºå…¥å£æ–‡ä»¶ cli.jsï¼š`touch cli.js # æ–°å»º cli.js æ–‡ä»¶`  ï¼ˆwindowéœ€è¦å®‰è£…touchï¼š`npm install touch-cli -g`ï¼‰

3. åœ¨ package.json æ–‡ä»¶ä¸­æŒ‡å®šå…¥å£æ–‡ä»¶ä¸º cli.jsï¼š

```js
{
  "name": "my-node-cli",
  "version": "1.0.0",
  "description": "",
  "main": "cli.js", // è®¾ç½®å…¥å£æ–‡ä»¶
  "bin": "cli.js", // æ‰‹åŠ¨æ·»åŠ å…¥å£æ–‡ä»¶ä¸º cli.js
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "jl",
  "license": "ISC"
}
```

4. æ­¤æ—¶é¡¹ç›®ç›®å½•ç»“æ„ï¼š

```bash
my-node-cli      
â”œâ”€ cli.js        
â””â”€ package.json     
```

5. æ‰“å¼€ cli.js è¿›è¡Œç¼–è¾‘

```js
#! /usr/bin/env node

// #! ç¬¦å·çš„åç§°å« Shebangï¼Œç”¨äºæŒ‡å®šè„šæœ¬çš„è§£é‡Šç¨‹åº
// Node CLI åº”ç”¨å…¥å£æ–‡ä»¶å¿…é¡»è¦æœ‰è¿™æ ·çš„æ–‡ä»¶å¤´
// å¦‚æœæ˜¯Linux æˆ–è€… macOS ç³»ç»Ÿä¸‹è¿˜éœ€è¦ä¿®æ”¹æ­¤æ–‡ä»¶çš„è¯»å†™æƒé™ä¸º 755
// å…·ä½“å°±æ˜¯é€šè¿‡ chmod 755 cli.js å®ç°ä¿®æ”¹

// ç”¨äºæ£€æŸ¥å…¥å£æ–‡ä»¶æ˜¯å¦æ­£å¸¸æ‰§è¡Œ
console.log('my-node-cli working~')
```

6. npm link é“¾æ¥åˆ°å…¨å±€

```bash
npm link # or yarn link
```

7. æˆ‘ä»¬å°±å¯ä»¥æ¥æµ‹è¯•äº†ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ my-node-cli æ‰§è¡Œä¸€ä¸‹ï¼Œå°±å¯ä»¥çœ‹åˆ°å‘½ä»¤è¡Œä¸­æ‰“å°äº†`my-node-cli working~`



### è¯¢é—®ç”¨æˆ·ä¿¡æ¯

å®ç°ä¸è¯¢é—®ç”¨æˆ·ä¿¡æ¯çš„åŠŸèƒ½éœ€è¦å¼•å…¥ inquirer.jsï¼Œä¸ºäº†ä½¿ç”¨ `require` å¼•å…¥ inquirer ï¼Œè¦ä½¿ç”¨ 8.2.5 ç‰ˆæœ¬çš„ inquirer

```
npm install inquirer@8.2.5 --dev
```

æ¥ç€æˆ‘ä»¬åœ¨ cli.js æ¥è®¾ç½®æˆ‘ä»¬çš„é—®é¢˜

```js
#! /usr/bin/env node

const inquirer = require('inquirer')

inquirer.prompt([
  {
    type: 'input', //typeï¼š input, number, confirm, list, checkbox ... 
    name: 'name', // key å
    message: 'Your name', // æç¤ºä¿¡æ¯
    default: 'my-node-cli' // é»˜è®¤å€¼
  }
]).then(answers => {
  // æ‰“å°äº’ç”¨è¾“å…¥ç»“æœ
  console.log(answers)
})
```

åœ¨å‘½ä»¤è¡Œè¾“å…¥ my-node-cli çœ‹ä¸€ä¸‹æ‰§è¡Œç»“æœ

![image-20231109101630771](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109101630771.png)



### ç”Ÿæˆå¯¹åº”çš„æ–‡ä»¶

æ–°å»º`templates `æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨é‡Œé¢æ–°å»ºindex.htmlå’Œcommon.cssæ–‡ä»¶

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    <!-- ejs è¯­æ³• -->
    <%= name %>
  </title>
</head>
<body>
  <h1><%= name %></h1>
</body>

</html>
```

```css
/* common.css */
body {
  margin: 20px auto;
  background-color: azure;
}
```

æ­¤æ—¶çš„ç›®å½•ç»“æ„

```bash
bashå¤åˆ¶ä»£ç my-node-cli           
â”œâ”€ templates          
â”‚  â”œâ”€ common.css      
â”‚  â””â”€ index.html      
â”œâ”€ cli.js             
â”œâ”€ package-lock.json  
â””â”€ package.json       
```



**æ¥ç€å®Œå–„æ–‡ä»¶ç”Ÿæˆé€»è¾‘**

è¿™é‡Œå€ŸåŠ© ejs æ¨¡ç‰ˆå¼•æ“å°†ç”¨æˆ·è¾“å…¥çš„æ•°æ®æ¸²æŸ“åˆ°æ¨¡ç‰ˆæ–‡ä»¶ä¸Š

```js
npm install ejs --save
```

å®Œå–„cli.js

```js
#! /usr/bin/env node

const inquirer = require('inquirer')
const path = require('path')
const fs = require('fs')
const ejs = require('ejs')

inquirer.prompt([
  {
    type: 'input', //typeï¼šinput,confirm,list,rawlist,checkbox,password...
    name: 'name', // key å
    message: 'Your name', // æç¤ºä¿¡æ¯
    default: 'my-node-cli' // é»˜è®¤å€¼
  }
]).then(answers => {
  // æ¨¡ç‰ˆæ–‡ä»¶ç›®å½•
  const destUrl = path.join(__dirname, 'templates'); 
  // ç”Ÿæˆæ–‡ä»¶ç›®å½•
  // process.cwd() å¯¹åº”æ§åˆ¶å°æ‰€åœ¨ç›®å½•
  const cwdUrl = process.cwd();
  // ä»æ¨¡ç‰ˆç›®å½•ä¸­è¯»å–æ–‡ä»¶
  fs.readdir(destUrl, (err, files) => {
    if (err) throw err;
    files.forEach((file) => {
      // ä½¿ç”¨ ejs æ¸²æŸ“å¯¹åº”çš„æ¨¡ç‰ˆæ–‡ä»¶
      // renderFileï¼ˆæ¨¡ç‰ˆæ–‡ä»¶åœ°å€ï¼Œä¼ å…¥æ¸²æŸ“æ•°æ®ï¼‰
      ejs.renderFile(path.join(destUrl, file), answers).then(data => {
        // ç”Ÿæˆ ejs å¤„ç†åçš„æ¨¡ç‰ˆæ–‡ä»¶
        fs.writeFileSync(path.join(cwdUrl, file) , data)
      })
    })
  })
})
```

åŒæ ·ï¼Œåœ¨æ§åˆ¶å°æ‰§è¡Œä¸€ä¸‹ my-node-cli ï¼Œæ­¤æ—¶ `index.html`ã€`common.css` å·²ç»æˆåŠŸåˆ›å»º

æˆ‘ä»¬æ‰“å°ä¸€ä¸‹å½“å‰çš„ç›®å½•ç»“æ„

```bash
my-node-cli           
â”œâ”€ templates          
â”‚  â”œâ”€ common.css      
â”‚  â””â”€ index.html      
â”œâ”€ cli.js             
â”œâ”€ common.css .................... ç”Ÿæˆå¯¹åº”çš„ common.css æ–‡ä»¶        
â”œâ”€ index.html .................... ç”Ÿæˆå¯¹åº”çš„ index.html æ–‡ä»¶        
â”œâ”€ package-lock.json  
â””â”€ package.json       
```

æ‰“å¼€ç”Ÿæˆçš„ index.html æ–‡ä»¶çœ‹ä¸€ä¸‹

```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- ejs è¯­æ³• -->
  <title>
    my-app
  </title>
</head>

<body>
  <h1>my-app</h1>
</body>

</html>
```

ç”¨æˆ·è¾“å…¥çš„ `{ name: 'my-app' }` å·²ç»æ·»åŠ åˆ°äº†ç”Ÿæˆçš„æ–‡ä»¶ä¸­äº†



## çƒ­é—¨è„šæ‰‹æ¶å·¥å…·åº“

### æ¨è

å®é™…ç”Ÿäº§ä¸­æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶æˆ–è€…é˜…è¯»å…¶ä»–è„šæ‰‹æ¶æºç çš„æ—¶å€™éœ€è¦äº†è§£ä¸‹é¢è¿™äº›å·¥å…·åº“

| åç§°                                                         | ç®€ä»‹                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [ commander](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftj%2Fcommander.js%2Fblob%2Fmaster%2FReadme_zh-CN.md) | å‘½ä»¤è¡Œè‡ªå®šä¹‰æŒ‡ä»¤                                             |
| [ inquirer](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSBoudrias%2FInquirer.js%2F) | å‘½ä»¤è¡Œè¯¢é—®ç”¨æˆ·é—®é¢˜ï¼Œè®°å½•å›ç­”ç»“æœ                             |
| [ chalk](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fchalk) | æ§åˆ¶å°è¾“å‡ºå†…å®¹æ ·å¼ç¾åŒ–                                       |
| [ ora](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fora) | æ§åˆ¶å° loading æ ·å¼                                          |
| [ figlet](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffiglet) | æ§åˆ¶å°æ‰“å° logo                                              |
| [ easy-table](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Feasy-table) | æ§åˆ¶å°è¾“å‡ºè¡¨æ ¼                                               |
| [ download-git-repo](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fdownload-git-repo) | ä¸‹è½½è¿œç¨‹æ¨¡ç‰ˆ                                                 |
| [ fs-extra](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffs-extra) | ç³»ç»Ÿfsæ¨¡å—çš„æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šä¾¿åˆ©çš„ APIï¼Œå¹¶ç»§æ‰¿äº†fsæ¨¡å—çš„ API |
| [ cross-spawn](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fcross-spawn) | æ”¯æŒè·¨å¹³å°è°ƒç”¨ç³»ç»Ÿä¸Šçš„å‘½ä»¤                                   |

é‡ç‚¹ä»‹ç»ä¸‹é¢è¿™äº›ï¼Œå…¶ä»–å·¥å…·å¯ä»¥æŸ¥çœ‹è¯´æ˜æ–‡æ¡£



### commander è‡ªå®šä¹‰å‘½ä»¤è¡ŒæŒ‡ä»¤

#### æ–°å»ºä¸€ä¸ªç®€å•çš„ Node Cli é¡¹ç›®

```js
// package.json
{
  "name": "one",
  "version": "1.0.0",
  "description": "",
  "bin": "./bin/cli.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "jl",
  "license": "ISC",
  "devDependencies": {
    "commander": "^11.1.0"
  }
}
```

ç›®å½•ç»“æ„ï¼š

```bash
one          
â”œâ”€ bin                
â”‚  â””â”€ cli.js          
â”œâ”€ package-lock.json  
â””â”€ package.json              
```



#### å¼•å…¥ commander ç¼–å†™ä»£ç 

```bash
# å®‰è£…ä¾èµ–
npm install commander # yarn add commander 
```

å®Œå–„ cli.js ä»£ç 

```js
#! /usr/bin/env node

const program = require('commander')

program
.version('0.1.0')
.command('create <name>')
.description('create a new project')
.action(name => { 
    // æ‰“å°å‘½ä»¤è¡Œè¾“å…¥çš„å€¼
    console.log("project name is " + name)
})

program.parse()
```



#### npm link é“¾æ¥åˆ°å…¨å±€

- æ‰§è¡Œ `npm link` å°†åº”ç”¨ `one` é“¾æ¥åˆ°å…¨å±€
- å®Œæˆä¹‹åï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ `one`

çœ‹ä¸€ä¸‹ï¼Œå‘½ä»¤è¡Œä¸­çš„è¾“å‡ºå†…å®¹

![image-20231109103430557](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109103430557.png)



è¿™ä¸ªæ—¶å€™å°±æœ‰äº† `one` å‘½ä»¤ä½¿ç”¨çš„è¯´æ˜ä¿¡æ¯ï¼Œåœ¨ Commands ä¸‹é¢å‡ºç°äº†æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ create å‘½ä»¤ `create <name>`ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä¸€ä¸‹

![image-20231109103458570](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109103458570.png)

è¿™ä¸ªæ—¶å€™æ§åˆ¶å°å°±æ‰“å°å‡ºæ¥ create å‘½ä»¤åé¢çš„ `<name>` å€¼



### chalk å‘½ä»¤è¡Œç¾åŒ–å·¥å…·

chalkï¼ˆç²‰ç¬”ï¼‰å¯ä»¥**ç¾åŒ–æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­è¾“å‡ºå†…å®¹çš„æ ·å¼**ï¼Œä¾‹å¦‚å¯¹é‡ç‚¹ä¿¡æ¯æ·»åŠ é¢œè‰²

å®‰è£…ä¾èµ–ï¼š`npm install chalk@4.1.2`ï¼Œéœ€è¦å®‰è£…è¯¥ç‰ˆæœ¬æ‰èƒ½åªèƒ½node

åœ¨é¡¹ç›®ä¸­æ‰“å¼€ bin/cli.js

```js
#! /usr/bin/env node

const program = require('commander')
const chalk = require('chalk')

program
.version('0.1.0')
.command('create <name>')
.description('create a new project')
.action(name => { 
    // æ‰“å°å‘½ä»¤è¡Œè¾“å…¥çš„å€¼

    // æ–‡æœ¬æ ·å¼
    console.log("project name is " + chalk.bold(name))

    // é¢œè‰²
    console.log("project name is " + chalk.cyan(name))
    console.log("project name is " + chalk.green(name))

    // èƒŒæ™¯è‰²
    console.log("project name is " + chalk.bgRed(name))

    // ä½¿ç”¨RGBé¢œè‰²è¾“å‡º
    console.log("project name is " + chalk.rgb(4, 156, 219).underline(name));
    console.log("project name is " + chalk.hex('#049CDB').bold(name));
    console.log("project name is " + chalk.bgHex('#049CDB').bold(name))
})

program.parse()
```

çœ‹ä¸€ä¸‹æ•ˆæœï¼š

![image-20231109104025772](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109104025772.png)



### inquirer å‘½ä»¤è¡Œäº¤äº’å·¥å…·

inquirer åœ¨è„šæ‰‹æ¶å·¥å…·ä¸­çš„**ä½¿ç”¨é¢‘ç‡æ˜¯éå¸¸é«˜**çš„ï¼Œå…¶å®åœ¨ä¸Šæ–‡**è„šæ‰‹æ¶çš„ç®€å•é›å½¢**ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨åˆ°äº†ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»äº†ã€‚



### ora å‘½ä»¤è¡Œ loading åŠ¨æ•ˆ

å®‰è£…ï¼š`npm install ora@5.4.1`

åœ¨bin/cliä¸­æ·»åŠ ï¼š

```js
const ora = require('ora')

// è‡ªå®šä¹‰æ–‡æœ¬ä¿¡æ¯
const message = 'Loading unicorns'
// åˆå§‹åŒ–
const spinner = ora(message);
// å¼€å§‹åŠ è½½åŠ¨ç”»
spinner.start();
setTimeout(() => {
    // ä¿®æ”¹åŠ¨ç”»æ ·å¼

    // Type: string
    // Default: 'cyan'
    // Values: 'black' | 'red' | 'green' | 'yellow' | 'blue' | 'magenta' | 'cyan' | 'white' | 'gray'
    spinner.color = 'red';    
    spinner.text = 'Loading rainbows';

    setTimeout(() => {
        // åŠ è½½çŠ¶æ€ä¿®æ”¹
        spinner.stop() // åœæ­¢
        spinner.succeed('Loading succeed'); // æˆåŠŸ âœ”
        // spinner.fail(text?);  å¤±è´¥ âœ–
        // spinner.warn(text?);  æç¤º âš 
        // spinner.info(text?);  ä¿¡æ¯ â„¹
    }, 2000);
}, 2000);
```

çœ‹æ•ˆæœ

![image-20231109104338692](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109104338692.png)



### cross-spawn è·¨å¹³å° shell å·¥å…· â€” å®‰è£…ä¾èµ–

å®‰è£…ï¼š`npm install cross-spawn`

åœ¨è„šæ‰‹æ¶é‡Œé¢ï¼Œå¯ä»¥ç”¨æ¥è‡ªåŠ¨æ‰§è¡Œ shell å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š

```js
#! /usr/bin/env node 

const spawn = require('cross-spawn');
const chalk = require('chalk')

// å®šä¹‰éœ€è¦æŒ‰ç…§çš„ä¾èµ–
const dependencies = ['vue', 'vuex', 'vue-router'];

// æ‰§è¡Œå®‰è£…
const child = spawn('npm', ['install', '-D'].concat(dependencies), { 
    stdio: 'inherit' 
});

// ç›‘å¬æ‰§è¡Œç»“æœ
child.on('close', function(code) {
    // æ‰§è¡Œå¤±è´¥
    if(code !== 0) {
        console.log(chalk.red('Error occurred while installing dependencies!'));
        process.exit(1);
    }
    // æ‰§è¡ŒæˆåŠŸ
    else {
        console.log(chalk.cyan('Install finished'))   
    }
})
```

çœ‹æ•ˆæœï¼š

![image-20231109104802647](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109104802647.png)





## ç®€ç­”è‡ªå·±çš„è„šæ‰‹æ¶

å…ˆç»™æˆ‘ä»¬çš„è„šæ‰‹æ¶èµ·ä¸ªåå­—å§ï¼Œå°±å«ï¼šxjn-cli

**éœ€è¦å®ç°å“ªäº›åŸºæœ¬åŠŸèƒ½ï¼š**

1. é€šè¿‡ `xjn create <name>` å‘½ä»¤å¯åŠ¨é¡¹ç›®
2. è¯¢é—®ç”¨æˆ·éœ€è¦é€‰æ‹©éœ€è¦ä¸‹è½½çš„æ¨¡æ¿
3. è¿œç¨‹æ‹‰å–æ¨¡æ¿æ–‡ä»¶

**æ­å»ºæ­¥éª¤æ‹†è§£ï¼š**

1. åˆ›å»ºé¡¹ç›®
2. åˆ›å»ºè„šæ‰‹æ¶å¯åŠ¨å‘½ä»¤ï¼ˆä½¿ç”¨ commanderï¼‰
3. è¯¢é—®ç”¨æˆ·é—®é¢˜è·å–åˆ›å»ºæ‰€éœ€ä¿¡æ¯ï¼ˆä½¿ç”¨ inquirerï¼‰
4. ä¸‹è½½è¿œç¨‹æ¨¡æ¿ï¼ˆä½¿ç”¨ download-git-repoï¼‰
5. å‘å¸ƒé¡¹ç›®



### åˆ›å»ºé¡¹ç›®

å…ˆåˆ›å»ºä¸€ä¸ªç®€å•çš„ Node-Cli ç»“æ„

```bash
zhurong-cli           
â”œâ”€ bin                
â”‚  â””â”€ cli.js  # å¯åŠ¨æ–‡ä»¶      
â”œâ”€ README.md          
â””â”€ package.json       
```

é…ç½®è„šæ‰‹æ¶å¯åŠ¨æ–‡ä»¶

```js
{
  "name": "xjn-cli",
  "version": "1.0.0",
  "description": "",
  "main": "./bin/cli.js",
  "bin": {
    "xjn": "./bin/cli.js"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "jl",
  "license": "ISC"
}
```

ç®€å•ç¼–è¾‘ä¸€ä¸‹æˆ‘ä»¬çš„ cli.js

```js
#! /usr/bin/env node

console.log('zhurong-cli working ~')
```

ç„¶å`npm link`ï¼Œ`xjn`ï¼Œæµ‹è¯•æ˜¯å¦æ‰“å°



### åˆ›å»ºè„šæ‰‹æ¶å¯åŠ¨å‘½ä»¤

**ç®€å•åˆ†æä¸€ä¸‹æˆ‘ä»¬è¦æ€ä¹ˆåšï¼Ÿ**

1. é¦–å…ˆæˆ‘ä»¬è¦å€ŸåŠ© commander ä¾èµ–å»å®ç°è¿™ä¸ªéœ€æ±‚
2. å‚ç…§ vue-cli å¸¸ç”¨çš„å‘½ä»¤æœ‰ createã€config ç­‰ç­‰ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬ä¸­å¯ä»¥ä½¿ç”¨ vue ui è¿›è¡Œå¯è§†åŒ–åˆ›å»º
3. å¦‚æœåˆ›å»ºçš„å­˜åœ¨ï¼Œéœ€è¦æç¤ºæ˜¯å¦è¦†ç›–



#### å®‰è£…ä¾èµ–

`npm install commander --save`



#### åˆ›å»ºå‘½ä»¤

æ‰“å¼€ cli.js è¿›è¡Œç¼–è¾‘

```js
#! /usr/bin/env node

const program = require('commander')

program
  // å®šä¹‰å‘½ä»¤å’Œå‚æ•°
  .command('create <app-name>')
  .description('create a new project')
  // -f or --force ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºçš„ç›®å½•å­˜åœ¨åˆ™ç›´æ¥è¦†ç›–
  .option('-f, --force', 'overwrite target directory if it exist')
  .action((name, options) => {
    // æ‰“å°æ‰§è¡Œç»“æœ
    console.log('name:',name,'options:',options)
  })
  
program
   // é…ç½®ç‰ˆæœ¬å·ä¿¡æ¯
  .version(`v${require('../package.json').version}`)
  .usage('<command> [option]')
  
// è§£æç”¨æˆ·æ‰§è¡Œå‘½ä»¤ä¼ å…¥å‚æ•°
program.parse(process.argv);
```



åœ¨å‘½ä»¤è¡Œè¾“å…¥ xjnï¼Œæ£€æŸ¥ä¸€ä¸‹å‘½ä»¤æ˜¯å¦åˆ›å»ºæˆåŠŸ

![image-20231109154144683](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109154144683.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Commands ä¸‹é¢å·²ç»æœ‰äº† `create [options] <app-name>`ï¼Œæ¥ç€æ‰§è¡Œä¸€ä¸‹è¿™ä¸ªå‘½ä»¤

![image-20231109154359906](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109154359906.png)

æˆåŠŸï¼



#### æ‰§è¡Œå‘½ä»¤

åˆ›å»º lib æ–‡ä»¶å¤¹å¹¶åœ¨æ–‡ä»¶å¤¹ä¸‹åˆ›å»º create.js

```js
// lib/create.js

module.exports = async function (name, options) {
  // éªŒè¯æ˜¯å¦æ­£å¸¸å–åˆ°å€¼
  console.log('>>> create.js', name, options)
}
```

åœ¨ cli.js ä¸­ä½¿ç”¨ create.js

```js
#! /usr/bin/env node

const program = require('commander')

program
  // å®šä¹‰å‘½ä»¤å’Œå‚æ•°
  .command('create <app-name>')
  .description('create a new project')
  // -f or --force ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºçš„ç›®å½•å­˜åœ¨åˆ™ç›´æ¥è¦†ç›–
  .option('-f, --force', 'overwrite target directory if it exist')
  .action((name, options) => {
    // åœ¨ create.js ä¸­æ‰§è¡Œåˆ›å»ºä»»åŠ¡
    require('../lib/create.js')(name, options)
  })
  
program
   // é…ç½®ç‰ˆæœ¬å·ä¿¡æ¯
  .version(`v${require('../package.json').version}`)
  .usage('<command> [option]')
  
// è§£æç”¨æˆ·æ‰§è¡Œå‘½ä»¤ä¼ å…¥å‚æ•°
program.parse(process.argv);
```

æ‰§è¡Œä¸€ä¸‹ `xjn create jl`ï¼Œæ­¤æ—¶åœ¨ create.js æ­£å¸¸æ‰“å°äº†æˆ‘ä»¬å‡ºå…¥çš„ä¿¡æ¯

![image-20231109174145109](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109174145109.png)



åœ¨åˆ›å»ºç›®å½•çš„æ—¶å€™ï¼Œéœ€è¦æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š**ç›®å½•æ˜¯å¦å·²ç»å­˜åœ¨ï¼Ÿ**

1. å¦‚æœå­˜åœ¨
   - å½“ `{ force: true }` æ—¶ï¼Œç›´æ¥ç§»é™¤åŸæ¥çš„ç›®å½•ï¼Œç›´æ¥åˆ›å»º
   - å½“ `{ force: false }` æ—¶ è¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦è¦†ç›–
2. å¦‚æœä¸å­˜åœ¨ï¼Œç›´æ¥åˆ›å»º

è¿™é‡Œç”¨åˆ°äº† fs çš„æ‰©å±•å·¥å…· [ fs-extra](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffs-extra)ï¼Œå…ˆæ¥å®‰è£…ä¸€ä¸‹

```js
# fs-extra æ˜¯å¯¹ fs æ¨¡å—çš„æ‰©å±•ï¼Œæ”¯æŒ promise 
npm install fs-extra --save
```

æˆ‘ä»¬æ¥ç€å®Œå–„ä¸€ä¸‹ create.js å†…éƒ¨çš„å®ç°é€»è¾‘

```js
// lib/create.js

const path = require('path')
const fs = require('fs-extra')

module.exports = async function (name, options) {
  // æ‰§è¡Œåˆ›å»ºå‘½ä»¤

  // å½“å‰å‘½ä»¤è¡Œé€‰æ‹©çš„ç›®å½•
  const cwd  = process.cwd();
  // éœ€è¦åˆ›å»ºçš„ç›®å½•åœ°å€
  const targetAir  = path.join(cwd, name)

  // ç›®å½•æ˜¯å¦å·²ç»å­˜åœ¨ï¼Ÿ
  if (fs.existsSync(targetAir)) {

    // æ˜¯å¦ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Ÿ
    if (options.force) {
      await fs.remove(targetAir)
    } else {
      // TODOï¼šè¯¢é—®ç”¨æˆ·æ˜¯å¦ç¡®å®šè¦è¦†ç›–
    }
  }
}
```

è¯¢é—®éƒ¨åˆ†çš„é€»è¾‘ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹æ–‡ç»§ç»­å®Œå–„



#### åˆ›å»ºæ›´å¤šçš„å‘½ä»¤

å¦‚æœæƒ³æ·»åŠ å…¶ä»–å‘½ä»¤ä¹Ÿæ˜¯åŒæ ·çš„å¤„ç†æ–¹å¼ï¼Œè¿™é‡Œå°±ä¸æ‰©å±•è¯´æ˜äº†ï¼Œç¤ºä¾‹å¦‚ä¸‹

```js
// bin/cli.js

// é…ç½® config å‘½ä»¤
program
  .command('config [value]')
  .description('inspect and modify the config')
  .option('-g, --get <path>', 'get value from option')
  .option('-s, --set <path> <value>')
  .option('-d, --delete <path>', 'delete option from config')
  .action((value, options) => {
    console.log(value, options)
  })

// é…ç½® ui å‘½ä»¤
program
  .command('ui')
  .description('start add open roc-cli ui')
  .option('-p, --port <port>', 'Port used for the UI Server')
  .action((option) => {
    console.log(option)
  })
```



#### å®Œå–„å¸®åŠ©ä¿¡æ¯

æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ vue-cli æ‰§è¡Œ --help æ‰“å°çš„ä¿¡æ¯

![image-20231109175008347](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109175008347.png)



å¯¹æ¯” `xjn --help` æ‰“å°çš„ç»“æœï¼Œç»“å°¾å¤„å°‘äº†ä¸€æ¡è¯´æ˜ä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬åšè¡¥å……ï¼Œé‡ç‚¹éœ€è¦æ³¨æ„**è¯´æ˜ä¿¡æ¯æ˜¯å¸¦æœ‰é¢œè‰²çš„**ï¼Œè¿™é‡Œå°±éœ€è¦ç”¨åˆ°æˆ‘ä»¬å·¥å…·åº“é‡Œé¢çš„ [chalk](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fchalk) æ¥å¤„ç†

å…ˆå®‰è£…ï¼š`npm install chalk@4.1.2`

ä¿®æ”¹`bin/cli.js`

```js
#! /usr/bin/env node

const program = require('commander')
const chalk = require('chalk')

program
  // å®šä¹‰å‘½ä»¤å’Œå‚æ•°
  .command('create <app-name>')
  .description('create a new project')
  // -f or --force ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºçš„ç›®å½•å­˜åœ¨åˆ™ç›´æ¥è¦†ç›–
  .option('-f, --force', 'overwrite target directory if it exist')
  .action((name, options) => {
    // åœ¨ create.js ä¸­æ‰§è¡Œåˆ›å»ºä»»åŠ¡
    require('../lib/create.js')(name, options)
  })

program
  // ç›‘å¬ --help æ‰§è¡Œ
  .on('--help', () => {
    // æ–°å¢è¯´æ˜ä¿¡æ¯
    console.log(`\r\nRun ${chalk.cyan(`xjn <command> --help`)} for detailed usage of given command\r\n`)
  })
  
program
   // é…ç½®ç‰ˆæœ¬å·ä¿¡æ¯
  .version(`v${require('../package.json').version}`)
  .usage('<command> [option]')
  
// è§£æç”¨æˆ·æ‰§è¡Œå‘½ä»¤ä¼ å…¥å‚æ•°
program.parse(process.argv);
```

![image-20231109175237012](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109175237012.png)



#### æ‰“å°ä¸ª Logo

å¦‚æœæ­¤æ—¶æˆ‘ä»¬æƒ³ç»™è„šæ‰‹æ¶æ•´ä¸ª Logoï¼Œå·¥å…·åº“é‡Œçš„ [figlet](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffiglet) å°±æ˜¯å¹²è¿™ä¸ªçš„

å®‰è£…ï¼š`npm install figlet`

ä¿®æ”¹cli.js

```js
#! /usr/bin/env node

const program = require('commander')
const chalk = require('chalk')
const figlet = require('figlet')

program
  // å®šä¹‰å‘½ä»¤å’Œå‚æ•°
  .command('create <app-name>')
  .description('create a new project')
  // -f or --force ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºçš„ç›®å½•å­˜åœ¨åˆ™ç›´æ¥è¦†ç›–
  .option('-f, --force', 'overwrite target directory if it exist')
  .action((name, options) => {
    // åœ¨ create.js ä¸­æ‰§è¡Œåˆ›å»ºä»»åŠ¡
    require('../lib/create.js')(name, options)
  })

  program
  .on('--help', () => {
    // ä½¿ç”¨ figlet ç»˜åˆ¶ Logo
    console.log('\r\n' + figlet.textSync('xjn', {
      font: 'Ghost',
      horizontalLayout: 'default',
      verticalLayout: 'default',
      width: 80,
      whitespaceBreak: true
    }));
    // æ–°å¢è¯´æ˜ä¿¡æ¯
    console.log(`\r\nRun ${chalk.cyan(`roc <command> --help`)} show details\r\n`)
  })

program
   // é…ç½®ç‰ˆæœ¬å·ä¿¡æ¯
  .version(`v${require('../package.json').version}`)
  .usage('<command> [option]')
  
// è§£æç”¨æˆ·æ‰§è¡Œå‘½ä»¤ä¼ å…¥å‚æ•°
program.parse(process.argv);
```

çœ‹æ‰§è¡Œæ•ˆæœï¼š

![image-20231109175720517](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109175720517.png)



### è¯¢é—®ç”¨æˆ·é—®é¢˜è·å–åˆ›å»ºæ‰€éœ€ä¿¡æ¯

è¿™é‡Œå¬å”¤æˆ‘ä»¬çš„è€æœ‹å‹ [ inquirer](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Finquirer)ï¼Œè®©ä»–æ¥å¸®æˆ‘ä»¬è§£å†³å‘½ä»¤è¡Œäº¤äº’çš„é—®é¢˜

**æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„ï¼š**

1. ä¸Šä¸€æ­¥é—ç•™ï¼šè¯¢é—®ç”¨æˆ·æ˜¯å¦è¦†ç›–å·²å­˜åœ¨çš„ç›®å½•
2. ç”¨æˆ·é€‰æ‹©æ¨¡æ¿
3. ç”¨æˆ·é€‰æ‹©ç‰ˆæœ¬
4. è·å–ä¸‹è½½æ¨¡æ¿çš„é“¾æ¥



#### è¯¢é—®æ˜¯å¦è¦†ç›–å·²å­˜åœ¨çš„ç›®å½•

è¿™é‡Œè§£å†³ä¸Šä¸€æ­¥é—ç•™çš„é—®é¢˜ï¼š

1. å¦‚æœç›®å½•å·²å­˜åœ¨
   - å½“ `{ force: false }` æ—¶ è¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦è¦†ç›–

é€»è¾‘å®é™…ä¸Šå·²ç»å®Œæˆï¼Œè¿™é‡Œè¡¥å……ä¸€ä¸‹è¯¢é—®çš„å†…å®¹

å…ˆå®‰è£…ï¼š`npm install inquirer@8.2.5 --dev`

ç„¶åè¯¢é—®ç”¨æˆ·æ˜¯å¦è¿›è¡Œ Overwrite

```js
// lib/create.js

const path = require('path')

// fs-extra æ˜¯å¯¹ fs æ¨¡å—çš„æ‰©å±•ï¼Œæ”¯æŒ promise è¯­æ³•
const fs = require('fs-extra')
const inquirer = require('inquirer')

module.exports = async function (name, options) {
  // æ‰§è¡Œåˆ›å»ºå‘½ä»¤

  // å½“å‰å‘½ä»¤è¡Œé€‰æ‹©çš„ç›®å½•
  const cwd  = process.cwd();
  // éœ€è¦åˆ›å»ºçš„ç›®å½•åœ°å€
  const targetAir  = path.join(cwd, name)

  // ç›®å½•æ˜¯å¦å·²ç»å­˜åœ¨ï¼Ÿ
  if (fs.existsSync(targetAir)) {

    // æ˜¯å¦ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Ÿ
    if (options.force) {
      await fs.remove(targetAir)
    } else {

      // è¯¢é—®ç”¨æˆ·æ˜¯å¦ç¡®å®šè¦è¦†ç›–
      let { action } = await inquirer.prompt([
        {
          name: 'action',
          type: 'list',
          message: 'Target directory already exists Pick an action:',
          choices: [
            {
              name: 'Overwrite',
              value: 'overwrite'
            },{
              name: 'Cancel',
              value: false
            }
          ]
        }
      ])

      if (!action) {
        return;
      } else if (action === 'overwrite') {
        // ç§»é™¤å·²å­˜åœ¨çš„ç›®å½•
        console.log(`\r\nRemoving...`)
        await fs.remove(targetAir)
      }
    }
  }
}
```



æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š

1. åœ¨å½“å‰ç›®å½•ï¼Œå³å‘½ä»¤è¡Œä¸­æ˜¾ç¤ºçš„ç›®å½•ä¸‹æ‰‹åŠ¨åˆ›å»º2ä¸ªç›®å½•ï¼Œè¿™é‡Œéšä¾¿å–åä¸º one å’Œ two
2. æ‰§è¡Œ `xjn create one`ï¼Œæ•ˆæœå¦‚ä¸‹

![image-20231109191150594](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109191150594.png)

3. æ‰§è¡Œ `xjn create two -f`ï¼Œå¯ä»¥ç›´æ¥çœ‹åˆ° my-project2 è¢«ç§»é™¤

![image-20231109191222937](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109191222937.png)



> **æ³¨æ„ï¼šä¸ºä»€ä¹ˆè¿™é‡Œåªåšç§»é™¤ï¼Ÿ** å› ä¸ºåé¢è·å–åˆ°æ¨¡æ¿åœ°å€åï¼Œä¸‹è½½çš„æ—¶å€™ä¼šç›´æ¥åˆ›å»ºé¡¹ç›®ç›®å½•



#### å¦‚ä½•è·å–æ¨¡ç‰ˆä¿¡æ¯

æˆ‘ä»¬åœ¨ lib ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª http.js ä¸“é—¨å¤„ç†æ¨¡æ¿å’Œç‰ˆæœ¬ä¿¡æ¯çš„è·å–

```js
// lib/http.js

// é€šè¿‡ axios å¤„ç†è¯·æ±‚
const axios = require('axios')

axios.interceptors.response.use(res => {
  return res.data;
})


/**
 * è·å–æ¨¡æ¿åˆ—è¡¨
 * @returns Promise
 */
async function getRepoList() {
  return axios.get('https://api.github.com/orgs/zhurong-cli/repos')
}

/**
 * è·å–ç‰ˆæœ¬ä¿¡æ¯
 * @param {string} repo æ¨¡æ¿åç§°
 * @returns Promise
 */
async function  getTagList(repo) {
  return axios.get(`https://api.github.com/repos/zhurong-cli/${repo}/tags`)
}

module.exports = {
  getRepoList,
  getTagList
}
```



#### ç”¨æˆ·é€‰æ‹©æ¨¡æ¿

æˆ‘ä»¬ä¸“é—¨æ–°å»ºä¸€ä¸ª Generator.js æ¥å¤„ç†é¡¹ç›®åˆ›å»ºé€»è¾‘

```js
// lib/Generator.js

class Generator {
    constructor (name, targetDir){
      // ç›®å½•åç§°
      this.name = name;
      // åˆ›å»ºä½ç½®
      this.targetDir = targetDir;
    }
  
    // æ ¸å¿ƒåˆ›å»ºé€»è¾‘
    create(){
  
    }
  }
  
  module.exports = Generator;  
```

åœ¨ create.js ä¸­å¼•å…¥ Generator ç±»

```js
// lib/create.js

const path = require('path')
const Generator = require('./Generator')

// fs-extra æ˜¯å¯¹ fs æ¨¡å—çš„æ‰©å±•ï¼Œæ”¯æŒ promise è¯­æ³•
const fs = require('fs-extra')
const inquirer = require('inquirer')

module.exports = async function (name, options) {
  // æ‰§è¡Œåˆ›å»ºå‘½ä»¤

  // å½“å‰å‘½ä»¤è¡Œé€‰æ‹©çš„ç›®å½•
  const cwd  = process.cwd();
  // éœ€è¦åˆ›å»ºçš„ç›®å½•åœ°å€
  const targetAir  = path.join(cwd, name)

  // ç›®å½•æ˜¯å¦å·²ç»å­˜åœ¨ï¼Ÿ
  if (fs.existsSync(targetAir)) {

    // æ˜¯å¦ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Ÿ
    if (options.force) {
      await fs.remove(targetAir)
    } else {

      // è¯¢é—®ç”¨æˆ·æ˜¯å¦ç¡®å®šè¦è¦†ç›–
      let { action } = await inquirer.prompt([
        {
          name: 'action',
          type: 'list',
          message: 'Target directory already exists Pick an action:',
          choices: [
            {
              name: 'Overwrite',
              value: 'overwrite'
            },{
              name: 'Cancel',
              value: false
            }
          ]
        }
      ])

      if (!action) {
        return;
      } else if (action === 'overwrite') {
        // ç§»é™¤å·²å­˜åœ¨çš„ç›®å½•
        console.log(`\r\nRemoving...`)
        await fs.remove(targetAir)
      }
    }
  }

  // åˆ›å»ºé¡¹ç›®
  const generator = new Generator(name, targetAir);

  // å¼€å§‹åˆ›å»ºé¡¹ç›®
  generator.create()
}
```



æ¥ç€æ¥å†™è¯¢é—®ç”¨æˆ·é€‰æ‹©æ¨¡ç‰ˆéƒ½é€»è¾‘

```js
// lib/Generator.js

const { getRepoList } = require('./http')
const ora = require('ora')
const inquirer = require('inquirer')

// æ·»åŠ åŠ è½½åŠ¨ç”»
async function wrapLoading(fn, message, ...args) {
  // ä½¿ç”¨ ora åˆå§‹åŒ–ï¼Œä¼ å…¥æç¤ºä¿¡æ¯ message
  const spinner = ora(message);
  // å¼€å§‹åŠ è½½åŠ¨ç”»
  spinner.start();

  try {
    // æ‰§è¡Œä¼ å…¥æ–¹æ³• fn
    const result = await fn(...args);
    // çŠ¶æ€ä¸ºä¿®æ”¹ä¸ºæˆåŠŸ
    spinner.succeed();
    return result; 
  } catch (error) {
    // çŠ¶æ€ä¸ºä¿®æ”¹ä¸ºå¤±è´¥
    spinner.fail('Request failed, refetch ...')
  } 
}

class Generator {
  constructor (name, targetDir){
    // ç›®å½•åç§°
    this.name = name;
    // åˆ›å»ºä½ç½®
    this.targetDir = targetDir;
  }

  // è·å–ç”¨æˆ·é€‰æ‹©çš„æ¨¡æ¿
  // 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®
  // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°
  // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°

  async getRepo() {
    // 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®
    const repoList = await wrapLoading(getRepoList, 'waiting fetch template');
    if (!repoList) return;

    // è¿‡æ»¤æˆ‘ä»¬éœ€è¦çš„æ¨¡æ¿åç§°
    const repos = repoList.map(item => item.name);

    // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°
    const { repo } = await inquirer.prompt({
      name: 'repo',
      type: 'list',
      choices: repos,
      message: 'Please choose a template to create project'
    })

    // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°
    return repo;
  }

  // æ ¸å¿ƒåˆ›å»ºé€»è¾‘
  // 1ï¼‰è·å–æ¨¡æ¿åç§°
  // 2ï¼‰è·å– tag åç§°
  // 3ï¼‰ä¸‹è½½æ¨¡æ¿åˆ°æ¨¡æ¿ç›®å½•
  async create(){

    // 1ï¼‰è·å–æ¨¡æ¿åç§°
    const repo = await this.getRepo()
    
    console.log('ç”¨æˆ·é€‰æ‹©äº†ï¼Œrepo=' + repo)
  }
}

module.exports = Generator;
```



æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹ç°åœ¨æ˜¯ä¸ªä»€ä¹ˆæ ·å­

![image-20231109191916591](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109191916591.png)

æˆåŠŸæ‹¿åˆ°æ¨¡æ¿åç§° repo çš„ç»“æœ



#### ç”¨æˆ·é€‰æ‹©ç‰ˆæœ¬

è¿‡ç¨‹å’Œä¸Šè¿°ä¸€æ ·

```js
// lib/Generator.js

const { getRepoList, getTagList } = require('./http')
const ora = require('ora')
const inquirer = require('inquirer')

// æ·»åŠ åŠ è½½åŠ¨ç”»
async function wrapLoading(fn, message, ...args) {
  // ä½¿ç”¨ ora åˆå§‹åŒ–ï¼Œä¼ å…¥æç¤ºä¿¡æ¯ message
  const spinner = ora(message);
  // å¼€å§‹åŠ è½½åŠ¨ç”»
  spinner.start();

  try {
    // æ‰§è¡Œä¼ å…¥æ–¹æ³• fn
    const result = await fn(...args);
    // çŠ¶æ€ä¸ºä¿®æ”¹ä¸ºæˆåŠŸ
    spinner.succeed();
    return result; 
  } catch (error) {
    // çŠ¶æ€ä¸ºä¿®æ”¹ä¸ºå¤±è´¥
    spinner.fail('Request failed, refetch ...')
  } 
}

class Generator {
  constructor (name, targetDir){
    // ç›®å½•åç§°
    this.name = name;
    // åˆ›å»ºä½ç½®
    this.targetDir = targetDir;
  }

  // è·å–ç”¨æˆ·é€‰æ‹©çš„æ¨¡æ¿
  // 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®
  // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°
  // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°
  async getRepo() {
    // 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®
    const repoList = await wrapLoading(getRepoList, 'waiting fetch template');
    if (!repoList) return;

    // è¿‡æ»¤æˆ‘ä»¬éœ€è¦çš„æ¨¡æ¿åç§°
    const repos = repoList.map(item => item.name);

    // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°
    const { repo } = await inquirer.prompt({
      name: 'repo',
      type: 'list',
      choices: repos,
      message: 'Please choose a template to create project'
    })

    // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°
    return repo;
  }


  // è·å–ç”¨æˆ·é€‰æ‹©çš„ç‰ˆæœ¬
  // 1ï¼‰åŸºäº repo ç»“æœï¼Œè¿œç¨‹æ‹‰å–å¯¹åº”çš„ tag åˆ—è¡¨
  // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±éœ€è¦ä¸‹è½½çš„ tag
  // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„ tag

  async getTag(repo) {
    // 1ï¼‰åŸºäº repo ç»“æœï¼Œè¿œç¨‹æ‹‰å–å¯¹åº”çš„ tag åˆ—è¡¨
    const tags = await wrapLoading(getTagList, 'waiting fetch tag', repo);
    if (!tags) return;
    
    // è¿‡æ»¤æˆ‘ä»¬éœ€è¦çš„ tag åç§°
    const tagsList = tags.map(item => item.name);

    // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±éœ€è¦ä¸‹è½½çš„ tag
    const { tag } = await inquirer.prompt({
      name: 'tag',
      type: 'list',
      choices: tagsList,
      message: 'Place choose a tag to create project'
    })

    // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„ tag
    return tag
  }


  // æ ¸å¿ƒåˆ›å»ºé€»è¾‘
  // 1ï¼‰è·å–æ¨¡æ¿åç§°
  // 2ï¼‰è·å– tag åç§°
  // 3ï¼‰ä¸‹è½½æ¨¡æ¿åˆ°æ¨¡æ¿ç›®å½•
  async create(){

    // 1ï¼‰è·å–æ¨¡æ¿åç§°
    const repo = await this.getRepo()

    // 2) è·å– tag åç§°
    const tag = await this.getTag(repo)
    
    console.log('ç”¨æˆ·é€‰æ‹©äº†ï¼Œrepo=' + repo)
  }
}

module.exports = Generator;
```

æ‰§è¡Œï¼š

![image-20231109192122323](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109192122323.png)



### ä¸‹è½½è¿œç¨‹æ¨¡æ¿

ä¸‹è½½è¿œç¨‹æ¨¡ç‰ˆéœ€è¦ä½¿ç”¨ [download-git-repo](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fdownload-git-repo) å·¥å…·åŒ…ï¼Œå®é™…ä¸Šå®ƒä¹Ÿåœ¨æˆ‘ä»¬ä¸Šé¢åˆ—çš„å·¥å…·èœå•ä¸Šï¼Œä½†æ˜¯åœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å®ƒæ˜¯**ä¸æ”¯æŒ promise**çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œéœ€è¦ä½¿ç”¨ ä½¿ç”¨ util æ¨¡å—ä¸­çš„ [promisify](https://link.juejin.cn?target=http%3A%2F%2Fnodejs.cn%2Fapi%2Futil.html%23util_util_promisify_original) æ–¹æ³•å¯¹å…¶è¿›è¡Œ promise åŒ–



#### å®‰è£…ä¾èµ–ä¸ promise åŒ–

```js
npm install download-git-repo --save
```

è¿›è¡Œ promise åŒ–å¤„ç†

```js
// lib/Generator.js

...
const util = require('util')
const downloadGitRepo = require('download-git-repo') // ä¸æ”¯æŒ Promise

class Generator {
  constructor (name, targetDir){
    ...

    // å¯¹ download-git-repo è¿›è¡Œ promise åŒ–æ”¹é€ 
    this.downloadGitRepo = util.promisify(downloadGitRepo);
  }
  
  ...
}
```

```js
// lib/Generator.js

const { getRepoList, getTagList } = require('./http')
const ora = require('ora')
const inquirer = require('inquirer')

const util = require('util')
const downloadGitRepo = require('download-git-repo') // ä¸æ”¯æŒ Promise

// æ·»åŠ åŠ è½½åŠ¨ç”»
async function wrapLoading(fn, message, ...args) {
  // ä½¿ç”¨ ora åˆå§‹åŒ–ï¼Œä¼ å…¥æç¤ºä¿¡æ¯ message
  const spinner = ora(message);
  // å¼€å§‹åŠ è½½åŠ¨ç”»
  spinner.start();

  try {
    // æ‰§è¡Œä¼ å…¥æ–¹æ³• fn
    const result = await fn(...args);
    // çŠ¶æ€ä¸ºä¿®æ”¹ä¸ºæˆåŠŸ
    spinner.succeed();
    return result; 
  } catch (error) {
    // çŠ¶æ€ä¸ºä¿®æ”¹ä¸ºå¤±è´¥
    spinner.fail('Request failed, refetch ...')
  } 
}

class Generator {
  constructor (name, targetDir){
    // ç›®å½•åç§°
    this.name = name;
    // åˆ›å»ºä½ç½®
    this.targetDir = targetDir;

     // å¯¹ download-git-repo è¿›è¡Œ promise åŒ–æ”¹é€ 
     this.downloadGitRepo = util.promisify(downloadGitRepo);
  }

  // è·å–ç”¨æˆ·é€‰æ‹©çš„æ¨¡æ¿
  // 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®
  // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°
  // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°
  async getRepo() {
    // 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®
    const repoList = await wrapLoading(getRepoList, 'waiting fetch template');
    if (!repoList) return;

    // è¿‡æ»¤æˆ‘ä»¬éœ€è¦çš„æ¨¡æ¿åç§°
    const repos = repoList.map(item => item.name);

    // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°
    const { repo } = await inquirer.prompt({
      name: 'repo',
      type: 'list',
      choices: repos,
      message: 'Please choose a template to create project'
    })

    // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°
    return repo;
  }


  // è·å–ç”¨æˆ·é€‰æ‹©çš„ç‰ˆæœ¬
  // 1ï¼‰åŸºäº repo ç»“æœï¼Œè¿œç¨‹æ‹‰å–å¯¹åº”çš„ tag åˆ—è¡¨
  // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±éœ€è¦ä¸‹è½½çš„ tag
  // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„ tag

  async getTag(repo) {
    // 1ï¼‰åŸºäº repo ç»“æœï¼Œè¿œç¨‹æ‹‰å–å¯¹åº”çš„ tag åˆ—è¡¨
    const tags = await wrapLoading(getTagList, 'waiting fetch tag', repo);
    if (!tags) return;
    
    // è¿‡æ»¤æˆ‘ä»¬éœ€è¦çš„ tag åç§°
    const tagsList = tags.map(item => item.name);

    // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±éœ€è¦ä¸‹è½½çš„ tag
    const { tag } = await inquirer.prompt({
      name: 'tag',
      type: 'list',
      choices: tagsList,
      message: 'Place choose a tag to create project'
    })

    // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„ tag
    return tag
  }


  // æ ¸å¿ƒåˆ›å»ºé€»è¾‘
  // 1ï¼‰è·å–æ¨¡æ¿åç§°
  // 2ï¼‰è·å– tag åç§°
  // 3ï¼‰ä¸‹è½½æ¨¡æ¿åˆ°æ¨¡æ¿ç›®å½•
  async create(){

    // 1ï¼‰è·å–æ¨¡æ¿åç§°
    const repo = await this.getRepo()

    // 2) è·å– tag åç§°
    const tag = await this.getTag(repo)
    
    console.log('ç”¨æˆ·é€‰æ‹©äº†ï¼Œrepo=' + repo)
  }
}

module.exports = Generator;
```



#### æ ¸å¿ƒä¸‹è½½åŠŸèƒ½

æ¥ç€ï¼Œå°±æ˜¯æ¨¡æ¿ä¸‹è½½éƒ¨åˆ†çš„é€»è¾‘äº†

```js
// lib/Generator.js

const { getRepoList, getTagList } = require('./http')
const ora = require('ora')
const inquirer = require('inquirer')

const util = require('util')
const downloadGitRepo = require('download-git-repo') // ä¸æ”¯æŒ Promise

// æ·»åŠ åŠ è½½åŠ¨ç”»
async function wrapLoading(fn, message, ...args) {
  // ä½¿ç”¨ ora åˆå§‹åŒ–ï¼Œä¼ å…¥æç¤ºä¿¡æ¯ message
  const spinner = ora(message);
  // å¼€å§‹åŠ è½½åŠ¨ç”»
  spinner.start();

  try {
    // æ‰§è¡Œä¼ å…¥æ–¹æ³• fn
    const result = await fn(...args);
    // çŠ¶æ€ä¸ºä¿®æ”¹ä¸ºæˆåŠŸ
    spinner.succeed();
    return result; 
  } catch (error) {
    // çŠ¶æ€ä¸ºä¿®æ”¹ä¸ºå¤±è´¥
    spinner.fail('Request failed, refetch ...')
  } 
}

class Generator {
  constructor (name, targetDir){
    // ç›®å½•åç§°
    this.name = name;
    // åˆ›å»ºä½ç½®
    this.targetDir = targetDir;

     // å¯¹ download-git-repo è¿›è¡Œ promise åŒ–æ”¹é€ 
     this.downloadGitRepo = util.promisify(downloadGitRepo);
  }

  // è·å–ç”¨æˆ·é€‰æ‹©çš„æ¨¡æ¿
  // 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®
  // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°
  // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°
  async getRepo() {
    // 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®
    const repoList = await wrapLoading(getRepoList, 'waiting fetch template');
    if (!repoList) return;

    // è¿‡æ»¤æˆ‘ä»¬éœ€è¦çš„æ¨¡æ¿åç§°
    const repos = repoList.map(item => item.name);

    // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°
    const { repo } = await inquirer.prompt({
      name: 'repo',
      type: 'list',
      choices: repos,
      message: 'Please choose a template to create project'
    })

    // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°
    return repo;
  }


  // è·å–ç”¨æˆ·é€‰æ‹©çš„ç‰ˆæœ¬
  // 1ï¼‰åŸºäº repo ç»“æœï¼Œè¿œç¨‹æ‹‰å–å¯¹åº”çš„ tag åˆ—è¡¨
  // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±éœ€è¦ä¸‹è½½çš„ tag
  // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„ tag

  async getTag(repo) {
    // 1ï¼‰åŸºäº repo ç»“æœï¼Œè¿œç¨‹æ‹‰å–å¯¹åº”çš„ tag åˆ—è¡¨
    const tags = await wrapLoading(getTagList, 'waiting fetch tag', repo);
    if (!tags) return;
    
    // è¿‡æ»¤æˆ‘ä»¬éœ€è¦çš„ tag åç§°
    const tagsList = tags.map(item => item.name);

    // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±éœ€è¦ä¸‹è½½çš„ tag
    const { tag } = await inquirer.prompt({
      name: 'tag',
      type: 'list',
      choices: tagsList,
      message: 'Place choose a tag to create project'
    })

    // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„ tag
    return tag
  }


  // ä¸‹è½½è¿œç¨‹æ¨¡æ¿
  // 1ï¼‰æ‹¼æ¥ä¸‹è½½åœ°å€
  // 2ï¼‰è°ƒç”¨ä¸‹è½½æ–¹æ³•
  async download(repo, tag){

    // 1ï¼‰æ‹¼æ¥ä¸‹è½½åœ°å€
    const requestUrl = `zhurong-cli/${repo}${tag?'#'+tag:''}`;

    // 2ï¼‰è°ƒç”¨ä¸‹è½½æ–¹æ³•
    await wrapLoading(
      this.downloadGitRepo, // è¿œç¨‹ä¸‹è½½æ–¹æ³•
      'waiting download template', // åŠ è½½æç¤ºä¿¡æ¯
      requestUrl, // å‚æ•°1: ä¸‹è½½åœ°å€
      path.resolve(process.cwd(), this.targetDir)) // å‚æ•°2: åˆ›å»ºä½ç½®
  }

  // æ ¸å¿ƒåˆ›å»ºé€»è¾‘
  // 1ï¼‰è·å–æ¨¡æ¿åç§°
  // 2ï¼‰è·å– tag åç§°
  // 3ï¼‰ä¸‹è½½æ¨¡æ¿åˆ°æ¨¡æ¿ç›®å½•
  // 4ï¼‰æ¨¡æ¿ä½¿ç”¨æç¤º
  async create(){

    // 1ï¼‰è·å–æ¨¡æ¿åç§°
    const repo = await this.getRepo()

    // 2) è·å– tag åç§°
    const tag = await this.getTag(repo)

    // 3ï¼‰ä¸‹è½½æ¨¡æ¿åˆ°æ¨¡æ¿ç›®å½•
    await this.download(repo, tag)
    
    // 4ï¼‰æ¨¡æ¿ä½¿ç”¨æç¤º
    console.log(`\r\nSuccessfully created project ${chalk.cyan(this.name)}`)
    console.log(`\r\n  cd ${chalk.cyan(this.name)}`)
    console.log('  npm run dev\r\n')
  }
  
}

module.exports = Generator;
```

å®Œæˆè¿™å—ï¼Œä¸€ä¸ªç®€å•çš„è„šæ‰‹æ¶å°±å®Œæˆäº†

æ¥è¯•ä¸€ä¸‹æ•ˆæœå¦‚ä½•

![image-20231109193309066](ä»0åˆ°1æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶.assets/image-20231109193309066.png)



### å‘å¸ƒé¡¹ç›®

ä¸Šé¢éƒ½æ˜¯åœ¨æœ¬åœ°æµ‹è¯•ï¼Œå®é™…åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯èƒ½å°±éœ€è¦å‘å¸ƒåˆ° npm ä»“åº“ï¼Œé€šè¿‡ npm å…¨å±€å®‰è£…ä¹‹åï¼Œç›´æ¥åˆ°ç›®æ ‡ç›®å½•ä¸‹é¢å»åˆ›å»ºé¡¹ç›®ï¼Œå¦‚ä½•å‘å¸ƒå‘¢ï¼Ÿ

1. ç¬¬ä¸€æ­¥ï¼Œåœ¨ git ä¸Šå»ºå¥½ä»“åº“
2. ç¬¬äºŒæ­¥ï¼Œå®Œå–„ package.json ä¸­çš„é…ç½®

```json
{
  "name": "xjn-cli",
  "version": "1.0.0",
  "description": "xjnçš„è„šæ‰‹æ¶",
  "main": "./bin/cli.js",
  "bin": {
    "xjn": "./bin/cli.js"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "files": [
    "bin",
    "lib"
  ],
  "author": {
    "name": "xjn",
    "github": "https://github.com/xiaojunnanya"
  },
  "keywords": [
    "xjn-cli",
    "jl",
    "è„šæ‰‹æ¶"
  ],
  "license": "ISC",
  "dependencies": {
    "axios": "^1.6.1",
    "chalk": "^4.1.2",
    "commander": "^11.1.0",
    "download-git-repo": "^3.0.2",
    "figlet": "^1.7.0",
    "fs-extra": "^11.1.1",
    "inquirer": "^8.2.5"
  }
}
```

3. ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨ `npm publish` è¿›è¡Œå‘å¸ƒï¼Œæ›´æ–°åˆ°æ—¶å€™ï¼Œæ³¨æ„ä¿®æ”¹ç‰ˆæœ¬å·

4. ä¹‹åè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ npm æˆ–è€… yarn å…¨å±€å®‰è£…ä½¿ç”¨äº†



### ä½¿ç”¨

1. å…ˆå…¨å±€å®‰è£…ï¼š`npm install xjn -g`
2. ä½¿ç”¨ï¼š`xjn create one`



## plopï¼šä¸€æ¬¾å°è€Œç¾çš„è„šæ‰‹æ¶å·¥å…·

> plop å°åœ¨ä½“ç§¯è½»é‡ï¼Œç¾åœ¨ç®€å•æ˜“ç”¨

æ›´å¤šä½¿ç”¨æ–¹æ³•  [ plop ä½¿ç”¨æ–‡æ¡£](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fplopjs%2Fplop)

æˆ‘ä»¬å¯ä»¥å°†å…¶ç›´æ¥é›†æˆåˆ°é¡¹ç›®ä¸­ï¼Œè§£å†³ä¸€ä¸‹é‡å¤æ€§çš„æ´»ç€éœ€è¦æ ‡å‡†åŒ–çš„åˆ›å»ºå·¥ä½œï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥åšä¸ªå°æ¡ˆä¾‹ï¼Œæ¯”å¦‚

**æˆ‘ä»¬å·²ç»çº¦å®šå¥½äº†ç»„ä»¶çš„åˆ›å»ºè§„èŒƒ**ï¼š

- ç»„ä»¶åç§°ä½¿ç”¨å¤§é©¼å³°
- æ ·å¼éœ€è¦å•ç‹¬æ‹§å‡ºæ¥å†™
- éœ€è¦æ­é…è¯´æ˜æ–‡æ¡£

**plop çš„ä½¿ç”¨è¿‡ç¨‹å¤§è‡´å¯ä»¥æ‹†è§£ä¸º**ï¼š

1. å®‰è£… plopï¼Œæ–°å¢é…ç½®æ–‡ä»¶ plopfile.js
2. ç¼–è¾‘ plop é…ç½®æ–‡ä»¶
3. åˆ›å»ºæ¨¡æ¿æ–‡ä»¶
4. æ‰§è¡Œåˆ›å»ºä»»åŠ¡

ä¸‹é¢è¿›å…¥ coding ç¯èŠ‚

### å®‰è£… plop

é¦–å…ˆç”¨æˆ‘ä»¬çš„ xjn-cli åˆå§‹åŒ–ä¸€ä¸ª vue é¡¹ç›®

```shell
# å…¨å±€å®‰è£…
$ npm install xjn-cli -g 
# åˆ›å»º vue é¡¹ç›®
$ xjn create plop-demo
```

æˆ‘ä»¬è¿™é‡Œä¸ºäº†å›¢é˜Ÿç»Ÿä¸€ä½¿ç”¨ï¼Œplop ç›´æ¥å°±é›†æˆåˆ°é¡¹ç›®ä¹‹ä¸­

```shell
npm install plop --save-dev
```

é¡¹ç›®ç›®å½•ä¸‹é¢åˆ›å»º plop çš„é…ç½®æ–‡ä»¶ plopfile.js



### ç¼–è¾‘ plop é…ç½®æ–‡ä»¶

```js
// ./plopfile.js

module.exports = plop => {
  plop.setGenerator('component', {
    // æè¿°
    description: 'create a component',
    // è¯¢é—®ç»„ä»¶çš„åç§°
    prompts: [
      {
        type: 'input',
        name: 'name',
        message: 'Your component name',
        default: 'MyComponent'
      }
    ],
    // è·å–åˆ°å›ç­”å†…å®¹åç»­çš„åŠ¨ä½œ
    actions: [
      //æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æ˜¯ä¸€ä¸ªåŠ¨ä½œ
      {
        type: 'add', // ä»£è¡¨æ·»åŠ æ–‡ä»¶
        // è¢«åˆ›å»ºæ–‡ä»¶çš„è·¯å¾„åŠåç§°
        // name ä¸ºç”¨æˆ·è¾“å…¥çš„ç»“æœï¼Œä½¿ç”¨ {{}} ä½¿ç”¨å˜é‡
        // properCase: plop è‡ªå¸¦æ–¹æ³•ï¼Œå°† name è½¬æ¢ä¸ºå¤§é©¼å³°
        path: 'src/components/{{ properCase name }}/index.vue',
        // æ¨¡æ¿æ–‡ä»¶åœ°å€
        templateFile: 'plop-templates/component.vue.hbs'
      },
      {
        type: 'add',
        path: 'src/components/{{ properCase name }}/index.scss',
        templateFile: 'plop-templates/component.scss.hbs'
      },
      {
        type: 'add',
        path: 'src/components/{{ properCase name }}/README.md',
        templateFile: 'plop-templates/README.md.hbs'
      }
    ]
  })
}
```

ä¸Šé¢ç”¨åˆ° properCase æ–¹æ³•å°† name è½¬åŒ–ä¸ºå¤§é©¼å³°ï¼Œå…¶ä»–æ ¼å¼è¿˜åŒ…æ‹¬

- `camelCase`: changeFormatToThis
- `snakeCase`: change_format_to_this
- `dashCase/kebabCase`: change-format-to-this
- `dotCase`: change.format.to.this
- `pathCase`: change/format/to/this
- `properCase/pascalCase`: ChangeFormatToThis
- `lowerCase`: change format to this
- `sentenceCase`: Change format to this,
- `constantCase`: CHANGE_FORMAT_TO_THIS
- `titleCase`: Change Format To This

æˆ‘ä»¬çœ‹åˆ°ä¸Šé¢å·²ç»å¼•ç”¨äº†æ¨¡æ¿æ–‡ä»¶ï¼Œå®é™…ä¸Šæˆ‘ä»¬è¿˜æ²¡åˆ›å»ºï¼Œæ¥ç€åˆ›å»ºä¸€ä¸‹



### åˆ›å»ºæ¨¡æ¿æ–‡ä»¶

é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»º plop-templates æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åˆ›å»ºå¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶

```shell
plop-templates         
â”œâ”€ README.md.hbs ............... è¯´æ˜æ–‡æ¡£æ¨¡æ¿     
â”œâ”€ component.scss.hbs .......... ç»„ä»¶æ ·å¼æ¨¡æ¿
â””â”€ component.vue.hbs ........... ç»„ä»¶æ¨¡æ¿
```



æ¨¡æ¿å¼•æ“æˆ‘ä»¬ç”¨åˆ°æ˜¯ Handlebars ï¼Œæ›´å¤šè¯­æ³•è¯´æ˜ [Handlebars ä¸­æ–‡ç½‘](https://link.juejin.cn?target=https%3A%2F%2Fwww.handlebarsjs.cn%2F)

ç¼–è¾‘ component.scss.hbs

```hbs
{{!-- ./plop-templates/component.scss.hbs --}}
{{!-- dashCase/kebabCase: change-format-to-this --}}
{{!-- name: è¾“å…¥æ¨¡æ¿åç§° --}}

.{{ dashCase name }} {

}
```

ç¼–è¾‘ component.vue.hbs

```hbs
{{!-- ./plop-templates/component.vue.hbs --}}

<template>
  <div class="{{ dashCase name }}">{{ name }}</div>
</template>

<script>
  export default {
    name: '{{ properCase name }}',
  }
</script>

<style lang="scss">
@import "./index.scss";

</style>
```

README.md.hbs

```hbs
hbså¤åˆ¶ä»£ç {{!-- ./plop-templates/README.md.hbs --}}

è¿™é‡Œæ˜¯ç»„ä»¶ {{ name }} çš„ä½¿ç”¨è¯´æ˜
```



è¡¥å……è¯´æ˜ï¼š

- è¿™é‡Œæ¨¡æ¿éƒ½æ˜¯æœ€ç®€å•å®ç°ï¼Œå®é™…ç”Ÿäº§ä¸­å¯ä»¥æ ¹æ®éœ€æ±‚ä¸°å¯Œæ¨¡æ¿å†…å®¹
- æ¨¡æ¿ä¸­çš„ dashCaseã€properCase ä¸ºå˜æ›´ name å‘½ä»¤çš„æ˜¾ç¤ºè§„åˆ™ï¼Œä¸Šæ–‡å·²ç»åˆ—è¡¨è¿‡
  - `dashCase`ï¼šå˜ä¸ºæ¨ªçº¿é“¾æ¥ aa-bb-cc
  - `properCase`ï¼šå˜ä¸ºå¤§é©¼å³° AaBbCc
  - `...`
- Handlebars ä¸­ä½¿ç”¨å˜é‡ï¼Œç”¨ `{{}}` åŒ…è£¹



### æ‰§è¡Œåˆ›å»ºä»»åŠ¡

æ‰“å¼€ package.json

```json
// scripts ä¸­ å¢åŠ ä¸€æ¡å‘½ä»¤
...
"scripts": {
    ...
    "plop": "plop"
  },
...  
```

æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ `npm run plop` æ¥åˆ›å»ºç»„ä»¶äº†



## å‚è€ƒé“¾æ¥

[ä» 0 æ„å»ºè‡ªå·±çš„è„šæ‰‹æ¶/CLIçŸ¥è¯†ä½“ç³»ï¼ˆä¸‡å­—ï¼‰ ğŸ›  - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/6966119324478079007)







